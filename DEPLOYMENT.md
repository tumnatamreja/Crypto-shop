# üöÄ Crypto Shop - Deployment Guide

–ü—ä–ª–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞ deployment –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç –Ω—É–ª–∞—Ç–∞.

---

## üìã –ü—Ä–µ–¥–∏ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—à

### –ù–µ–æ–±—Ö–æ–¥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏:
- **Node.js** (v18+)
- **PostgreSQL** (v14+)
- **Git**
- **npm** –∏–ª–∏ **yarn**

---

## 1Ô∏è‚É£ –ö–õ–û–ù–ò–†–ê–ù–ï –ù–ê –ü–†–û–ï–ö–¢–ê

```bash
# –ö–ª–æ–Ω–∏—Ä–∞–π –ø—Ä–æ–µ–∫—Ç–∞
git clone https://github.com/tumnatamreja/Crypto-shop.git
cd Crypto-shop

# –°–º–µ–Ω–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—è –±—Ä–∞–Ω—á (–∞–∫–æ –µ –Ω—É–∂–Ω–æ)
git checkout claude/upload-privacy-project-011CUKLk8uC5a66QpcumRJ5Z
```

---

## 2Ô∏è‚É£ –ù–ê–°–¢–†–û–ô–ö–ê –ù–ê –ë–ê–ó–ê–¢–ê –î–ê–ù–ù–ò

### –°—Ç—ä–ø–∫–∞ 1: –°—ä–∑–¥–∞–π PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

```sql
-- –õ–æ–≥–Ω–∏ —Å–µ –≤ PostgreSQL
psql -U postgres

-- –°—ä–∑–¥–∞–π –±–∞–∑–∞ –¥–∞–Ω–Ω–∏
CREATE DATABASE cryptoshop;

-- –°—ä–∑–¥–∞–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª (optional)
CREATE USER cryptoshop_user WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE cryptoshop TO cryptoshop_user;

-- –°–≤—ä—Ä–∂–∏ —Å–µ —Å –±–∞–∑–∞—Ç–∞
\c cryptoshop
```

### –°—Ç—ä–ø–∫–∞ 2: –ò–∑–ø—ä–ª–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏—Ç–µ

–ö–æ–ø–∏—Ä–∞–π –∏ –∏–∑–ø—ä–ª–Ω–∏ SQL —Ñ–∞–π–ª–æ–≤–µ—Ç–µ –ø–æ —Ä–µ–¥:

```bash
# 1. –û—Å–Ω–æ–≤–Ω–∞ —Å—Ö–µ–º–∞
psql -U postgres -d cryptoshop -f backend/migrations/001_initial_schema.sql

# 2. Product Variants —Å–∏—Å—Ç–µ–º–∞
psql -U postgres -d cryptoshop -f backend/migrations/002_product_variants.sql

# (–ê–∫–æ –∏–º–∞—à –¥—Ä—É–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ, –∏–∑–ø—ä–ª–Ω–∏ –≥–∏ –ø–æ —Ä–µ–¥)
```

**–ò–ª–∏** –∏–∑–ø—ä–ª–Ω–∏ SQL-–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ psql:

```sql
-- –í–∏–∂ backend/migrations/001_initial_schema.sql
-- –í–∏–∂ backend/migrations/002_product_variants.sql
```

---

## 3Ô∏è‚É£ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ù–ê ENVIRONMENT VARIABLES

### Backend Environment (.env)

–°—ä–∑–¥–∞–π —Ñ–∞–π–ª `backend/.env`:

```bash
cd backend
nano .env
```

–î–æ–±–∞–≤–∏ —Å–ª–µ–¥–Ω–æ—Ç–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ:

```env
# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=cryptoshop
DB_USER=postgres
DB_PASSWORD=your_postgres_password

# JWT Secret (–≥–µ–Ω–µ—Ä–∏—Ä–∞–π —Å–∏–≥—É—Ä–µ–Ω random string)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# Server Configuration
PORT=3001
NODE_ENV=production

# OxaPay API Configuration (White Label)
OXAPAY_API_KEY=your_oxapay_api_key
OXAPAY_MERCHANT_API_KEY=your_oxapay_merchant_key
OXAPAY_WEBHOOK_SECRET=your_webhook_secret

# OxaPay Webhook URL (–≤–∞—à–∏—è—Ç –ø—É–±–ª–∏—á–µ–Ω URL)
OXAPAY_CALLBACK_URL=https://yourdomain.com/api/webhook/oxapay
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –°–º–µ–Ω–∏ –≤—Å–∏—á–∫–∏ `your_*` —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ —Å —Ä–µ–∞–ª–Ω–∏—Ç–µ —Ç–∏ –¥–∞–Ω–Ω–∏!

**–ö–∞–∫ –¥–∞ –ø–æ–ª—É—á–∏—à OxaPay –∫–ª—é—á–æ–≤–µ:**
1. –û—Ç–∏–¥–∏ –Ω–∞ https://oxapay.com
2. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π —Å–µ / –í–ª–µ–∑
3. –û—Ç–∏–¥–∏ –≤ Settings ‚Üí API Keys
4. –ö–æ–ø–∏—Ä–∞–π: API Key, Merchant Key, Webhook Secret

### Frontend Environment (.env.local)

–°—ä–∑–¥–∞–π —Ñ–∞–π–ª `frontend/.env.local`:

```bash
cd ../frontend
nano .env.local
```

–î–æ–±–∞–≤–∏:

```env
# Backend API URL
NEXT_PUBLIC_API_URL=http://localhost:3001
```

**–ó–∞ production —Å—ä—Ä–≤—ä—Ä:**
```env
NEXT_PUBLIC_API_URL=https://api.yourdomain.com
```

---

## 4Ô∏è‚É£ –ò–ù–°–¢–ê–õ–ê–¶–ò–Ø –ù–ê DEPENDENCIES

### Backend Dependencies

```bash
cd backend
npm install
```

### Frontend Dependencies

```bash
cd ../frontend
npm install
```

---

## 5Ô∏è‚É£ BUILD –ù–ê –ü–†–û–ï–ö–¢–ê

### Build Backend (TypeScript ‚Üí JavaScript)

```bash
cd backend
npm run build
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å—ä–∑–¥–∞–¥–µ `backend/dist/` –ø–∞–ø–∫–∞ —Å compiled JS —Ñ–∞–π–ª–æ–≤–µ.

```bash
ls -la dist/
# –¢—Ä—è–±–≤–∞ –¥–∞ –≤–∏–¥–∏—à: server.js, controllers/, config/, etc.
```

### Build Frontend (Next.js)

```bash
cd ../frontend
npm run build
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢—Ä—è–±–≤–∞ –¥–∞ –≤–∏–¥–∏—à success build message:

```
‚úì Compiled successfully
‚úì Generating static pages
```

---

## 6Ô∏è‚É£ –°–¢–ê–†–¢–ò–†–ê–ù–ï –ù–ê –°–™–†–í–™–†–ò–¢–ï

### –ú–µ—Ç–æ–¥ 1: PM2 (–ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ –∑–∞ Production)

```bash
# –í—ä—Ä–Ω–∏ —Å–µ –≤ root –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞
cd ..

# –°—Ç–∞—Ä—Ç–∏—Ä–∞–π —Å PM2
npx pm2 start ecosystem.config.js

# –ü—Ä–æ–≤–µ—Ä–∏ —Å—Ç–∞—Ç—É—Å–∞
npx pm2 status

# –í–∏–∂ –ª–æ–≥–æ–≤–µ—Ç–µ
npx pm2 logs

# –°–ø—Ä–∏ –≤—Å–∏—á–∫–∏
npx pm2 stop all

# –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π
npx pm2 restart all
```

**PM2 —â–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞:**
- Backend –Ω–∞ –ø–æ—Ä—Ç 3001
- Frontend –Ω–∞ –ø–æ—Ä—Ç 3002

### –ú–µ—Ç–æ–¥ 2: –†—ä—á–Ω–æ (–ó–∞ Development)

**Terminal 1 - Backend:**
```bash
cd backend
npm run dev
# –ò–ª–∏ –∑–∞ production:
# npm start
```

**Terminal 2 - Frontend:**
```bash
cd frontend
npm run dev
# –ò–ª–∏ –∑–∞ production:
# npm start
```

---

## 7Ô∏è‚É£ –ü–†–û–í–ï–†–ö–ê

### Test Backend

```bash
# Health check
curl http://localhost:3001/health

# –û—á–∞–∫–≤–∞–Ω –æ—Ç–≥–æ–≤–æ—Ä:
# {"status":"ok","message":"CryptoShop API is running"}
```

### Test Frontend

–û—Ç–≤–æ—Ä–∏ –≤ –±—Ä–∞—É–∑—ä—Ä:
```
http://localhost:3002
```

–¢—Ä—è–±–≤–∞ –¥–∞ –≤–∏–¥–∏—à SinHuella Corp landing page.

### Test Admin Login

```
http://localhost:3002/admin/login
```

**–ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–µ–Ω admin –∞–∫–∞—É–Ω—Ç:**
–ù—è–º–∞ default admin. –¢—Ä—è–±–≤–∞ –¥–∞ —Å—ä–∑–¥–∞–¥–µ—à —Ä—ä—á–Ω–æ:

```sql
-- –í–ª–µ–∑ –≤ PostgreSQL
psql -U postgres -d cryptoshop

-- –°—ä–∑–¥–∞–π admin –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª (–ø–∞—Ä–æ–ª–∞—Ç–∞ –µ —Ö–µ—à–∏—Ä–∞–Ω–∞ "admin123")
INSERT INTO users (username, password_hash, is_admin, telegram, referral_code)
VALUES (
  'admin',
  '$2a$10$xYz...', -- –∏–∑–ø–æ–ª–∑–≤–∞–π bcrypt hash –Ω–∞ –ø–∞—Ä–æ–ª–∞—Ç–∞
  true,
  '@admin_telegram',
  'ADMIN001'
);
```

**–ò–ª–∏** —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π —Å–µ –ø—Ä–µ–∑ UI –∏ –ø—Ä–æ–º–µ–Ω–∏ is_admin –Ω–∞ true –≤ –±–∞–∑–∞—Ç–∞:

```sql
UPDATE users SET is_admin = true WHERE username = '—Ç–≤–æ–µ—Ç–æ_username';
```

---

## 8Ô∏è‚É£ –ü–™–†–í–û–ù–ê–ß–ê–õ–ù–ê –ù–ê–°–¢–†–û–ô–ö–ê

### 1. –î–æ–±–∞–≤–∏ –ì—Ä–∞–¥–æ–≤–µ –∏ –ö–≤–∞—Ä—Ç–∞–ª–∏

```sql
-- –î–æ–±–∞–≤–∏ –≥—Ä–∞–¥–æ–≤–µ
INSERT INTO cities (name, name_en, sort_order, is_active) VALUES
('–°–æ—Ñ–∏—è', 'Sofia', 1, true),
('–ü–ª–æ–≤–¥–∏–≤', 'Plovdiv', 2, true),
('–í–∞—Ä–Ω–∞', 'Varna', 3, true);

-- –í–∑–µ–º–∏ ID –Ω–∞ –°–æ—Ñ–∏—è
-- –î–∞ —Ä–µ—á–µ–º –µ '123e4567-e89b-12d3-a456-426614174000'

-- –î–æ–±–∞–≤–∏ –∫–≤–∞—Ä—Ç–∞–ª–∏ –∑–∞ –°–æ—Ñ–∏—è
INSERT INTO districts (city_id, name, name_en, sort_order, is_active) VALUES
('123e4567-e89b-12d3-a456-426614174000', '–¶–µ–Ω—Ç—ä—Ä', 'Center', 1, true),
('123e4567-e89b-12d3-a456-426614174000', '–õ—é–ª–∏–Ω', 'Lyulin', 2, true),
('123e4567-e89b-12d3-a456-426614174000', '–ú–ª–∞–¥–æ—Å—Ç', 'Mladost', 3, true);
```

### 2. –°—ä–∑–¥–∞–π –¢–µ—Å—Ç–æ–≤ –ü—Ä–æ–¥—É–∫—Ç

**–ß—Ä–µ–∑ Admin Panel:**
1. Login: http://localhost:3002/admin/login
2. –û—Ç–∏–¥–∏ –≤ Products tab
3. –ù–∞—Ç–∏—Å–Ω–∏ "Add Product"
4. –ü–æ–ø—ä–ª–Ω–∏: Name, Description, Price (–±–∞–∑–æ–≤–∞ —Ü–µ–Ω–∞), Picture URL
5. Save

### 3. –î–æ–±–∞–≤–∏ Locations –∫—ä–º –ø—Ä–æ–¥—É–∫—Ç–∞

1. –í Products list, –Ω–∞—Ç–∏—Å–Ω–∏ "Locations"
2. –ò–∑–±–µ—Ä–∏ –≥—Ä–∞–¥–æ–≤–µ—Ç–µ –∫—ä–¥–µ—Ç–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –µ –Ω–∞–ª–∏—á–µ–Ω
3. –ò–∑–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∞–ª–∏—Ç–µ
4. Save

### 4. –î–æ–±–∞–≤–∏ Variants (–í—Ä–µ–º–µ–Ω–Ω–æ —á—Ä–µ–∑ SQL - –¥–æ–∫–∞—Ç–æ –Ω–∞–ø—Ä–∞–≤–∏–º Admin UI)

```sql
-- –í–∑–µ–º–∏ product_id –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –æ—Ç admin –ø–∞–Ω–µ–ª–∞
-- –î–∞ —Ä–µ—á–µ–º –µ 'prod-123-456-789'

-- –î–æ–±–∞–≤–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∏
INSERT INTO product_variants (product_id, variant_name, variant_type, amount, price, sort_order, is_active)
VALUES
  ('prod-123-456-789', '5–≥—Ä', '–≥—Ä', 5, 45.00, 1, true),
  ('prod-123-456-789', '10–≥—Ä', '–≥—Ä', 10, 85.00, 2, true),
  ('prod-123-456-789', '25–≥—Ä', '–≥—Ä', 25, 200.00, 3, true);

-- –í–∑–µ–º–∏ variant IDs
SELECT id, variant_name FROM product_variants WHERE product_id = 'prod-123-456-789';

-- –î–∞ —Ä–µ—á–µ–º:
-- variant_5gr_id = 'var-111'
-- variant_10gr_id = 'var-222'
-- variant_25gr_id = 'var-333'

-- –î–æ–±–∞–≤–∏ stock –∑–∞ –≤—Å–µ–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç –≤ –°–æ—Ñ–∏—è
INSERT INTO variant_stock (variant_id, city_id, stock_amount, reserved_amount, low_stock_threshold)
VALUES
  ('var-111', '123e4567-e89b-12d3-a456-426614174000', 100, 0, 10),
  ('var-222', '123e4567-e89b-12d3-a456-426614174000', 50, 0, 5),
  ('var-333', '123e4567-e89b-12d3-a456-426614174000', 20, 0, 3);
```

---

## 9Ô∏è‚É£ –¢–ï–°–¢–í–ê–ù–ï –ù–ê –ü–™–õ–ù–ò–Ø FLOW

### Customer Flow:

1. **–û—Ç–≤–æ—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç:**
   ```
   http://localhost:3002/order/[product-id]
   ```

2. **–ò–∑–±–µ—Ä–∏ –ª–æ–∫–∞—Ü–∏—è:**
   - –ò–∑–±–µ—Ä–∏ –ì—Ä–∞–¥ (–Ω–∞–ø—Ä. –°–æ—Ñ–∏—è)
   - –ò–∑–±–µ—Ä–∏ –ö–≤–∞—Ä—Ç–∞–ª (–Ω–∞–ø—Ä. –ú–ª–∞–¥–æ—Å—Ç)

3. **–ò–∑–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç:**
   - –©–µ —Å–µ –ø–æ—è–≤—è—Ç –Ω–∞–ª–∏—á–Ω–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∏ —Å —Ü–µ–Ω–∏ –∏ stock
   - –ò–∑–±–µ—Ä–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä "5–≥—Ä - ‚Ç¨45.00"

4. **–ò–∑–±–µ—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:**
   - –í–∏–∂–¥–∞—à –æ–±—â–∞—Ç–∞ —Ü–µ–Ω–∞

5. **Proceed to Payment:**
   - –°—ä–∑–¥–∞–≤–∞ —Å–µ order
   - Stock —Å–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–∞
   - –ü—Ä–µ–ø—Ä–∞—â–∞ —Ç–µ –Ω–∞ payment —Å—Ç—Ä–∞–Ω–∏—Ü–∞

6. **Payment —Å—Ç—Ä–∞–Ω–∏—Ü–∞:**
   ```
   http://localhost:3002/payment/[order-id]
   ```
   - –ò–∑–±–µ—Ä–∏ –∫—Ä–∏pto –≤–∞–ª—É—Ç–∞ (BTC, ETH, USDT, etc.)
   - –ì–µ–Ω–µ—Ä–∏—Ä–∞ —Å–µ payment address
   - –°–∫–µ–Ω–∏—Ä–∞–π QR –∫–æ–¥–∞ –∏–ª–∏ –∫–æ–ø–∏—Ä–∞–π –∞–¥—Ä–µ—Å–∞
   - –ò–∑–ø—Ä–∞—Ç–∏ –ø–ª–∞—â–∞–Ω–µ—Ç–æ

7. **Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
   - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ –ø–ª–∞—â–∞–Ω–µ ‚Üí Stock —Å–µ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–∞
   - –ü—Ä–∏ –∏–∑—Ç–µ–∫—ä–ª order ‚Üí Stock —Å–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–≤–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Stock:

```sql
-- –í–∏–∂ stock levels
SELECT
  p.name as product,
  pv.variant_name,
  c.name as city,
  vs.stock_amount,
  vs.reserved_amount,
  (vs.stock_amount - vs.reserved_amount) as available
FROM variant_stock vs
JOIN product_variants pv ON vs.variant_id = pv.id
JOIN products p ON pv.product_id = p.id
JOIN cities c ON vs.city_id = c.id
ORDER BY p.name, pv.sort_order, c.name;
```

---

## üîü PRODUCTION DEPLOYMENT

### Nginx Configuration (Reverse Proxy)

```nginx
# Backend API
server {
    listen 80;
    server_name api.yourdomain.com;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# Frontend
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### SSL (Let's Encrypt)

```bash
# Install certbot
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–∏ SSL certificates
sudo certbot --nginx -d yourdomain.com -d api.yourdomain.com

# Auto-renewal
sudo certbot renew --dry-run
```

### PM2 Startup (Auto-start on reboot)

```bash
# –ì–µ–Ω–µ—Ä–∏—Ä–∞–π startup script
npx pm2 startup

# Save current PM2 process list
npx pm2 save

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–µ–¥ reboot
npx pm2 resurrect
```

---

## üõ†Ô∏è TROUBLESHOOTING

### Backend –Ω–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏ –ª–æ–≥–æ–≤–µ—Ç–µ
npx pm2 logs backend

# –ß–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏:
# 1. Database connection failed
#    ‚Üí –ü—Ä–æ–≤–µ—Ä–∏ DB_HOST, DB_PASSWORD –≤ backend/.env
#    ‚Üí psql -U postgres -d cryptoshop (test connection)

# 2. Port already in use
#    ‚Üí lsof -i :3001
#    ‚Üí kill -9 [PID]

# 3. dist/ folder missing
#    ‚Üí cd backend && npm run build
```

### Frontend –Ω–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏ –ª–æ–≥–æ–≤–µ—Ç–µ
npx pm2 logs frontend

# –ß–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏:
# 1. Build failed
#    ‚Üí cd frontend && npm run build

# 2. Port already in use
#    ‚Üí lsof -i :3002
#    ‚Üí kill -9 [PID]

# 3. API connection failed
#    ‚Üí –ü—Ä–æ–≤–µ—Ä–∏ NEXT_PUBLIC_API_URL –≤ frontend/.env.local
```

### Database –≥—Ä–µ—à–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ PostgreSQL —Ä–∞–±–æ—Ç–∏
sudo systemctl status postgresql

# –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π PostgreSQL
sudo systemctl restart postgresql

# –ü—Ä–æ–≤–µ—Ä–∏ connection
psql -U postgres -d cryptoshop -c "SELECT version();"

# –í–∏–∂ –∞–∫—Ç–∏–≤–Ω–∏ connections
SELECT * FROM pg_stat_activity WHERE datname = 'cryptoshop';
```

### OxaPay webhook –Ω–µ —Ä–∞–±–æ—Ç–∏:

1. **–õ–æ–∫–∞–ª–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ:**
   - –ò–∑–ø–æ–ª–∑–≤–∞–π ngrok –∑–∞ –ø—É–±–ª–∏—á–µ–Ω URL:
   ```bash
   ngrok http 3001
   # –ö–æ–ø–∏—Ä–∞–π URL: https://xxxx.ngrok.io
   # Webhook URL: https://xxxx.ngrok.io/api/webhook/oxapay
   ```

2. **Production:**
   - Webhook URL: https://api.yourdomain.com/api/webhook/oxapay
   - –î–æ–±–∞–≤–∏ –≤ OxaPay dashboard

3. **Debug webhook:**
   ```bash
   # –í–∏–∂ –ª–æ–≥–æ–≤–µ
   npx pm2 logs backend | grep webhook
   ```

---

## üìä –ü–û–õ–ï–ó–ù–ò –ö–û–ú–ê–ù–î–ò

```bash
# PM2
npx pm2 status              # –í–∏–∂ —Å—Ç–∞—Ç—É—Å
npx pm2 logs                # –í–∏–∂ –≤—Å–∏—á–∫–∏ –ª–æ–≥–æ–≤–µ
npx pm2 logs backend        # Backend –ª–æ–≥–æ–≤–µ
npx pm2 logs frontend       # Frontend –ª–æ–≥–æ–≤–µ
npx pm2 restart all         # –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π –≤—Å–∏—á–∫–∏
npx pm2 stop all            # –°–ø—Ä–∏ –≤—Å–∏—á–∫–∏
npx pm2 delete all          # –ò–∑—Ç—Ä–∏–π –æ—Ç PM2

# Database
psql -U postgres -d cryptoshop                    # –í–ª–µ–∑ –≤ DB
psql -U postgres -d cryptoshop -f migration.sql   # –ò–∑–ø—ä–ª–Ω–∏ SQL file
pg_dump -U postgres cryptoshop > backup.sql       # Backup
psql -U postgres -d cryptoshop < backup.sql       # Restore

# Git
git pull origin main                # –û–±–Ω–æ–≤–∏ –æ—Ç GitHub
git status                          # –í–∏–∂ –ø—Ä–æ–º–µ–Ω–∏
git log --oneline -10              # –ü–æ—Å–ª–µ–¥–Ω–∏ 10 commits

# Node/NPM
npm install                         # –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π dependencies
npm run build                       # Build –ø—Ä–æ–µ–∫—Ç–∞
npm start                          # –°—Ç–∞—Ä—Ç–∏—Ä–∞–π production
npm run dev                        # –°—Ç–∞—Ä—Ç–∏—Ä–∞–π development

# System
lsof -i :3001                      # –í–∏–∂ –∫–∞–∫–≤–æ –∏–∑–ø–æ–ª–∑–≤–∞ –ø–æ—Ä—Ç 3001
kill -9 [PID]                      # –£–±–∏–π –ø—Ä–æ—Ü–µ—Å
df -h                              # Disk space
free -h                            # Memory usage
```

---

## üìö –§–ê–ô–õ–û–í–ê –°–¢–†–£–ö–¢–£–†–ê

```
Crypto-shop/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/        # Route handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/         # Auth, validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # OxaPay, business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/             # Database config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/              # TypeScript types
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.ts           # Express app
‚îÇ   ‚îú‚îÄ‚îÄ dist/                   # Compiled JS (generated)
‚îÇ   ‚îú‚îÄ‚îÄ migrations/             # SQL migration files
‚îÇ   ‚îú‚îÄ‚îÄ .env                    # Environment variables
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json
‚îÇ
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # Home page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/             # Admin panel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order/             # Order pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment/           # Payment pages
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile/           # User profile
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts             # API client
‚îÇ   ‚îú‚îÄ‚îÄ .env.local             # Environment variables
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ next.config.js
‚îÇ
‚îú‚îÄ‚îÄ ecosystem.config.js         # PM2 configuration
‚îú‚îÄ‚îÄ DEPLOYMENT.md              # –¢–æ–≤–∞ —Ä—ä–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îî‚îÄ‚îÄ README.md                  # Project README
```

---

## ‚úÖ CHECKLIST –ó–ê DEPLOYMENT

- [ ] PostgreSQL –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω –∏ —Ä–∞–±–æ—Ç–∏
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω–∏ —Å—ä–∑–¥–∞–¥–µ–Ω–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏
- [ ] Backend .env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω
- [ ] Frontend .env.local –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω
- [ ] Backend dependencies –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–∏
- [ ] Frontend dependencies –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–∏
- [ ] Backend build —É—Å–ø–µ—à–µ–Ω (dist/ created)
- [ ] Frontend build —É—Å–ø–µ—à–µ–Ω
- [ ] PM2 —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–∏ –ø—Ä–æ—Ü–µ—Å–∏
- [ ] Backend health check –æ—Ç–≥–æ–≤–∞—Ä—è
- [ ] Frontend —Å–µ –∑–∞—Ä–µ–∂–¥–∞ –≤ –±—Ä–∞—É–∑—ä—Ä
- [ ] Admin –∞–∫–∞—É–Ω—Ç —Å—ä–∑–¥–∞–¥–µ–Ω
- [ ] –ì—Ä–∞–¥–æ–≤–µ –∏ –∫–≤–∞—Ä—Ç–∞–ª–∏ –¥–æ–±–∞–≤–µ–Ω–∏
- [ ] –¢–µ—Å—Ç–æ–≤ –ø—Ä–æ–¥—É–∫—Ç —Å—ä–∑–¥–∞–¥–µ–Ω
- [ ] –í–∞—Ä–∏–∞–Ω—Ç–∏ –¥–æ–±–∞–≤–µ–Ω–∏
- [ ] Stock –Ω–∞–ª–∏—á–µ–Ω
- [ ] OxaPay –∫–ª—é—á–æ–≤–µ –¥–æ–±–∞–≤–µ–Ω–∏
- [ ] Test order flow —Ä–∞–±–æ—Ç–∏
- [ ] Payment flow —Ä–∞–±–æ—Ç–∏
- [ ] Webhook —Ç–µ—Å—Ç–≤–∞–Ω

---

## üÜò SUPPORT

–ê–∫–æ –∏–º–∞—à –ø—Ä–æ–±–ª–µ–º–∏:

1. **–ü—Ä–æ–≤–µ—Ä–∏ –ª–æ–≥–æ–≤–µ—Ç–µ:**
   ```bash
   npx pm2 logs
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏:**
   ```bash
   psql -U postgres -d cryptoshop
   SELECT * FROM users LIMIT 1;
   ```

3. **–¢–µ—Å—Ç–≤–∞–π API:**
   ```bash
   curl http://localhost:3001/health
   ```

4. **–†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π –≤—Å–∏—á–∫–æ:**
   ```bash
   npx pm2 restart all
   ```

---

**–ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–µ–∫—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Ä–∞–±–æ—Ç–∏.** üéâ
